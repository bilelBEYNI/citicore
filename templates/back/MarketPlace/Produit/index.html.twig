{% extends 'back/Dashboard.html.twig' %}

{% block title %}Catalogue des Produits{% endblock %}

{% block stylesheets %}
  {{ parent() }}
  <link rel="stylesheet" href="{{ asset('styles/marketplace/style.css') }}">
{% endblock %}
{% block body %}
<div class="container my-5" style="margin-left: 250px; padding-bottom: 50px;">
  <h1 class="mb-4 favoris-title">Catalogue des Produits</h1>

  <div class="d-flex justify-content-between align-items-center mb-3">

    <a href="{{ path('app_produit_') }}" class="btn btn-primary btn-lg">Ajouter un Produit</a>

    <!-- Barre de recherche stylisée -->
    <input type="text" class="form-control w-25" placeholder="Rechercher un produit..." id="searchInput">
  </div>

  <table class="table table-hover table-striped">
    <thead class="thead-light" style="background-color: #9B59B6; color: #fff;">
      <tr>
        <th>Nom</th>
        <th>Description</th>
        <th>Prix</th>
        <th>Date d'ajout</th>
        <th>Photo</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="produitTable">
      {% for produit in pagination %}
        <tr style="background-color: #fff; border-radius: 10px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
          <td>{{ produit.nom }}</td>
          <td>{{ produit.description }}</td>
          <td class="favoris-prix">{{ produit.prix }} €</td>
          <td>{{ produit.dateAjout|date('d/m/Y') }}</td>
          <td>
            {% if produit.photo %}
              <img src="{{ asset('uploads/' ~ produit.photo) }}" class="img-thumbnail favoris-image" style="max-width:100px;">
            {% else %}
              <span class="text-muted">Aucun</span>
            {% endif %}
          </td>
          <td class="text-end">
            <a href="{{ path('edit', {'idProduit': produit.idProduit}) }}" class="btn btn-warning btn-sm">Modifier</a>

            <form method="post"
                  action="{{ path('delete', {'idProduit': produit.idProduit}) }}"
                  onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce produit ?');"
                  class="d-inline-block">
              <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ produit.idProduit) }}">
              <button type="submit" class="btn btn-danger btn-sm">Supprimer</button>
            </form>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted">Aucun produit trouvé.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="d-flex justify-content-center my-4">
    <nav>
      <ul class="pagination">
        <li class="page-item {% if pagination.currentPageNumber == 1 %}disabled{% endif %}">
          <a class="page-link" href="{{ path('app_produit_', {'page': pagination.currentPageNumber - 1}) }}" tabindex="-1">Précédent</a>
        </li>
        {% for page in 1..pagination.pageCount %}
          <li class="page-item {% if pagination.currentPageNumber == page %}active{% endif %}">
            <a class="page-link" href="{{ path('app_produit_', {'page': page}) }}">{{ page }}</a>
          </li>
        {% endfor %}
        <li class="page-item {% if pagination.currentPageNumber == pagination.pageCount %}disabled{% endif %}">
          <a class="page-link" href="{{ path('app_produit_', {'page': pagination.currentPageNumber + 1}) }}">Suivant</a>
        </li>
      </ul>
    </nav>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
  const searchInput = document.getElementById('searchInput');
  const tableRows   = document.querySelectorAll('#produitTable tr');
  searchInput.addEventListener('keyup', function () {
    const filter = this.value.toLowerCase();
    tableRows.forEach(row => {
      row.style.display = row.innerText.toLowerCase().includes(filter) ? '' : 'none';
    });
  });
});
</script>

{% endblock %}


